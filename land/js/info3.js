const PARAMS={apiLandingUrl:"https://clickgo.pro/r/url",apiUpdateRedirect:"https://clickgo.pro/r/update",apiUserUuid:"https://api.infocrm.net/api/public/user/uuid",promoTypeLand:"land",promoTypePreland:"preland",redirectId:"r_id",landingUuid:"landing_uuid",userUuid:"user_uuid",pubId:"pub_id",postbackType:"postback_type",psType:"ps_type",vkId:"vk_id",ttId:"tt_id",mailId:"mail_id",yandexTrackerId:"yandex_id",bigoTrackerId:"ba_id",googleTrackerId:"google_id",fbTrackerId:"fb_id",clarityId:"clarity_id",age:"age"},cookieName={userUuid:"info_userUuid",redirectUrl:"info_redirectUrl",redirectId:"info_redirectId",landingUrl:"info_landingUrl",landingUuid:"info_landingUuid",pubId:"info_pubId",postbackType:"info_postbackType",psType:"info_psType",token:"token",tokenExpire:"tokenExpire"},state={recordedReq:!1,routerEntries:["tt_id","fb_id","yandex_id","google_id","vk_id","ba_id","clarity_id","age"]};function getAllNeedData(){if(state.recordedReq)return!1;state.recordedReq=!0;const{routerEntries:e}=state,t=window.location.search;if(t){const n=new URLSearchParams(t),o=Object.fromEntries(n.entries());e.forEach((e=>{const t=o[e];t&&localStorage.setItem(e,t)}))}}function fillUrlParams(){const e=JSON.parse(window.localStorage.getItem("affStarInt")||"{}"),t=new URLSearchParams,{routerEntries:n}=state,o=window.localStorage;if(Object.keys(o).length&&n.forEach((e=>{const n=o[e];n&&t.set(e,n)})),Object.keys(e).length)for(const n in e)if(Object.hasOwnProperty.call(e,n)){const o=e[n];t.set(n,o)}if(!window.location.search&&t.toString()){if(window.ASIP){const e=window.location.hostname.toString(),n=new Date(Date.now()+2592e3);window.ASIP.cookie.setCookie("ASIPSearch",t.toString(),{"max-age":2592e3,expires:n,domain:"."+e})}window.location.search=t.toString()}}let queryParams;function getQueryString(){let e=window.location.search;return"?"===e.substr(0,1)&&(e=e.substr(1)),e}function parseQueryString(e,t){let n={};if(!e.length)return n;let o=e.split(t);for(let e=0;e<o.length;e++){let t=o[e].split(/=(.+)/),i=decodeURIComponent(t[0]),a=decodeURIComponent(t[1]);"undefined"!==i&&"undefined"!==a&&(n[i]=a)}return n}function findParam(e){let t;queryParams||(queryParams=parseQueryString(getQueryString(),"&"));for(let n in queryParams)if(n===e){t=queryParams[n];break}return t}function getParam(e,t){let n=findParam(e);return n?setCookie(t,n):n=getCookie(t),n}function getDomainWithoutSubdomains(e){const t=e.split(".");return t.slice(0).slice(-(4===t.length?3:2)).join(".")}function setCookie(e,t){let n=new Date;n.setTime(n.getTime()+7776e6);let o=[e+"="+t,"path=/","expires="+n.toUTCString(),"domain=."+getDomainWithoutSubdomains(window.location.host),"samesite=none","secure"];document.cookie=o.join(";")}function getCookie(e){return parseQueryString(document.cookie,"; ")[e]||null}function cookieNameByUser(e,t){return e+"_"+t}function generateUUID(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)}))}function createXhr(e,t){let n=new XMLHttpRequest;return n.open(e,t,!1),n.setRequestHeader("Content-Type","application/json"),n}function buildQueryFromParams(e){return Object.keys(e).map((function(t){if(null!==e[t]&&void 0!==e[t])return t+"="+e[t]})).filter((function(e){return!!e})).join("&")}let info={};info.init=function(e,t){let n=function(e){let t=getCookie(cookieName.userUuid+"_"+e);return t||(t=findParam(PARAMS.userUuid),t||(t=generateUUID()),setCookie(cookieName.userUuid+"_"+e,t),t)}(t),o=getParam(PARAMS.redirectId,cookieNameByUser(cookieName.redirectId,n)),i=getParam(PARAMS.pubId,cookieNameByUser(cookieName.pubId,n)),a=getParam(PARAMS.postbackType,cookieNameByUser(cookieName.postbackType,n)),r=getParam(PARAMS.psType,cookieNameByUser(cookieName.psType,n)),s=function(e,t){let n=getCookie(cookieNameByUser(cookieName.redirectUrl,t));return n||(n=function(e,t){console.log("checkRedirectUrl");let n="",o=JSON.stringify({project_uuid:e,website_user_uuid:t}),i=createXhr("POST",PARAMS.apiUserUuid);return i.onreadystatechange=function(){if(i.readyState===XMLHttpRequest.DONE&&200===i.status){console.log(i.response),console.log("checkRedirectUrl xhr 200");let e=JSON.parse(i.response);!0===e.success?e.data.redirect_url&&(n=e.data.redirect_url):console.log("checkRedirectUrl success===false")}else console.log("checkRedirectUrl xhr is not 200")},i.send(o),n}(e,t),setCookie(cookieNameByUser(cookieName.redirectUrl,t),n)),n}(t,n);if(s&&(window.location.href=s),e===PARAMS.promoTypePreland){let e=getCookie(cookieNameByUser(cookieName.landingUrl,n));(o&&!e||localStorage.getItem("refreshLandingUrl"))&&(console.log(localStorage.getItem("refreshLandingUrl")),e=function(e,t,n,o,i){let a="",r={r_id:e,mail_id:countersList.mail_id,yandex_id:countersList.yandex_id,google_id:countersList.google_id,vk_id:countersList.vk_id,ba_id:countersList.ba_id,fb_id:countersList.fb_id,tt_id:countersList.tt_id,clarity_id:countersList.clarity_id},s=createXhr("GET",PARAMS.apiLandingUrl+"?"+buildQueryFromParams(r));s.onreadystatechange=function(){if(s.readyState===XMLHttpRequest.DONE&&200===s.status){console.log("landingUrl xhr === 200");let e=JSON.parse(s.response);!0===e.success?a=e.data.url:console.log("landingUrl success===false")}else console.log(s.response),console.log("landingUrl xhr !== 200")},s.send();let c={};return c[PARAMS.userUuid]=t,c[PARAMS.pubId]=n,c[PARAMS.postbackType]=o,c[PARAMS.psType]=i,a+"&"+buildQueryFromParams(c)}(o,n),setCookie(cookieNameByUser(cookieName.landingUrl,n),e),localStorage.getItem("refreshLandingUrl")&&localStorage.setItem("refreshLandingUrl",!1)),function(e){console.log("replaceAllLinkToLandingUrl");let t=document.getElementsByClassName("info-link-to-land");localStorage.getItem("age")&&(e+="&age="+localStorage.getItem("age"));for(let n=0;n<t.length;n++)"A"===t[n].tagName&&(t[n].href=e)}(e)}if(e===PARAMS.promoTypeLand){!function(e,t,n,o,i){let a={mail_id:countersList.mail_id,yandex_id:countersList.yandex_id,google_id:countersList.google_id,vk_id:countersList.vk_id,fb_id:countersList.fb_id,ba_id:countersList.ba_id,tt_id:countersList.tt_id,clarity_id:countersList.clarity_id},r=document.getElementsByClassName("info-form-registration");for(let s=0;s<r.length;s++)r[s].addEventListener("submit",(function(r){r.preventDefault();let s=r.target.getElementsByTagName("button");s[0].disabled=!0;let c="",d="",l=r.target.getElementsByTagName("input");for(let e=0;e<l.length;e++)"email"===l[e].name&&(c=l[e].value),"phone"===l[e].name&&(d=l[e].value);let u={metrics:a};localStorage.getItem("age")&&(u.person_info={age:localStorage.getItem("age")});let p=JSON.stringify({r_id:e,email:c,phone:d,uuid:t,pub_id:n,postback_type:o,ps_type:i,extra:u}),g=createXhr("POST",window.location.protocol+"//api."+getDomainWithoutSubdomains(window.location.host)+"/api/public/user/registration");g.onreadystatechange=function(){if(g.readyState===XMLHttpRequest.DONE&&200===g.status){console.log("registration xhr 200"),console.log(g.response);let e=JSON.parse(g.response);!0===e.success?(e.data.access_token&&e.data.access_token_expired_at&&(setCookie(cookieName.token,e.data.access_token),setCookie(cookieName.tokenExpire,e.data.access_token_expired_at)),setCookie(cookieNameByUser(cookieName.redirectUrl,t),e.data.redirect_url),window.location.href=e.data.redirect_url+"&"+buildQueryFromParams(a)):(console.log("landingUrl success===false"),alert("Проверьте правильность email и попробуйте еще раз."),s[0].disabled=!1)}else console.log("registration xhr is not 200"),console.log(g.response)},g.send(p)}))}(o,n,i,a,r);let e=getParam(PARAMS.landingUuid,cookieNameByUser(cookieName.landingUuid,n));o&&e&&function(e,t){console.log("updateRedirect");let n=createXhr("POST",PARAMS.apiUpdateRedirect);n.onreadystatechange=function(){n.readyState===XMLHttpRequest.DONE&&200===n.status?(console.log(n.response),console.log("updateRedirect xhr 200")):console.log("updateRedirect xhr is not 200")};let o=JSON.stringify({r_id:e,landing_uuid:t});n.send(o)}(o,e)}};const countersList={vk_id:findParam(PARAMS.vkId),yandex_id:findParam(PARAMS.yandexTrackerId),google_id:findParam(PARAMS.googleTrackerId),fb_id:findParam(PARAMS.fbTrackerId),showcase:findParam(PARAMS.showcase),flow_id:findParam(PARAMS.flowId),tt_id:findParam(PARAMS.ttId),mail_id:findParam(PARAMS.mailId),ba_id:findParam(PARAMS.bigoTrackerId),clarity_id:findParam(PARAMS.clarityId)},isConfirm=window.location.pathname.includes("confirm");function counters(){var e,t,n;countersList.mail_id&&(e=countersList.mail_id,function(e,t){(window._tmr||(window._tmr=[])).push({id:t,type:"pageView",start:(new Date).getTime()}),function(e,t,n){if(!e.getElementById(n)){var o=e.createElement("script");o.type="text/javascript",o.async=!0,o.id=n,o.src=("https:"==e.location.protocol?"https:":"http:")+"//top-fwz1.mail.ru/js/code.js";var i=function(){var t=e.getElementsByTagName("script")[0];t.parentNode.insertBefore(o,t)};"[object Opera]"==t.opera?e.addEventListener("DOMContentLoaded",i,!1):i()}}(document,window,"topmailru-code");var n=e.createElement("img"),o=e.createElement("div"),i=e.createElement("noscript");n.src="//top-fwz1.mail.ru/counter?id="+t+";js=na",n.style="border:0;",n.height=1,n.width=1,o.style="position:absolute;left:-10000px;",o.appendChild(n),i.appendChild(o),e.body.appendChild(i)}(document,e)),countersList.yandex_id&&(t=countersList.yandex_id,function(e,n,o,i){(n[o]=n[o]||[]).push((function(){try{n.yacounter[t]=new Ya.Metrika({id:i,clickmap:!0,trackLinks:!0,accurateTrackBounce:!0,webvisor:!0})}catch(e){}}));var a=e.getElementsByTagName("script")[0],r=e.createElement("script"),s=function(){a.parentNode.insertBefore(r,a)};r.type="text/javascript",r.async=!0,r.src="https://mc.yandex.ru/metrika/watch.js","[object Opera]"==n.opera?e.addEventListener("DOMContentLoaded",s,!1):s()}(document,window,"yandex_metrika_callbacks",t)),countersList.google_id&&function(e){var t=document.head,n=document.createElement("script");n.src="https://www.googletagmanager.com/gtag/js?id='"+e+"'";var o=document.createElement("script");o.append("window.dataLayer = window.dataLayer || []; \n   function gtag(){dataLayer.push(arguments);} \n   gtag('js', new Date()); \n   gtag('config', '"+e+"'); \n"),t.prepend(o),t.prepend(n)}(countersList.google_id),countersList.fb_id&&function(e){const t=isConfirm?"Lead":"PageView";var n,o,i,a,r,s;n=window,o=document,i="script",n.fbq||(a=n.fbq=function(){a.callMethod?a.callMethod.apply(a,arguments):a.queue.push(arguments)},n._fbq||(n._fbq=a),a.push=a,a.loaded=!0,a.version="2.0",a.queue=[],(r=o.createElement(i)).async=!0,r.src="https://connect.facebook.net/en_US/fbevents.js",(s=o.getElementsByTagName(i)[0]).parentNode.insertBefore(r,s)),fbq("init",e),fbq("track",t)}(countersList.fb_id),countersList.tt_id&&(n=countersList.tt_id,function(e,t,o){e.TiktokAnalyticsObject=o;var i=e[o]=e[o]||[];i.methods=["page","track","identify","instances","debug","on","off","once","ready","alias","group","enableCookie","disableCookie"],i.setAndDefer=function(e,t){e[t]=function(){e.push([t].concat(Array.prototype.slice.call(arguments,0)))}};for(var a=0;a<i.methods.length;a++)i.setAndDefer(i,i.methods[a]);i.instance=function(e){for(var t=i._i[e]||[],n=0;n<i.methods.length;n++)i.setAndDefer(t,i.methods[n]);return t},i.load=function(e,t){var n="https://analytics.tiktok.com/i18n/pixel/events.js";i._i=i._i||{},i._i[e]=[],i._i[e]._u=n,i._t=i._t||{},i._t[e]=+new Date,i._o=i._o||{},i._o[e]=t||{};var a=document.createElement("script");a.type="text/javascript",a.async=!0,a.src=n+"?sdkid="+e+"&lib="+o;var r=document.getElementsByTagName("script")[0];r.parentNode.insertBefore(a,r)},i.load(n),i.page()}(window,document,"ttq")),countersList.vk_id&&function(e){var t=document.head,n=document.createElement("script");n.append("!function(){var\nt=document.createElement('script');t.type='text/javascript',t.async=!0,t.\nsrc='https://vk.com/js/api/openapi.js?161',t.onload=function()\n{VK.Retargeting.Init('"+e+"'),VK.Retargeting.Hit()},document.head.appendChild(t)}();\n");var o=document.createElement("noscript");o.append("<img src='https://vk.com/rtrg?p="+e+"' style='position: fixed; left:-999px;' alt=''>"),t.prepend(n),t.prepend(o)}(countersList.vk_id),countersList.ba_id&&function(e){var t=document.head,n=document.createElement("script");n.append(`window.bgdataLayer = window.bgdataLayer || []; \n   function bge(){bgdataLayer.push(arguments);} \n   bge('init',"${e}"); \n   bge('event', 'page_view'); \n`);var o=document.createElement("script");o.async=!0,o.src="https://api.imotech.video/ad/events.js?pixel_id="+e,t.prepend(o),t.prepend(n)}(countersList.ba_id)}try{counters()}catch(e){console.error(e)}function getAge(){document.querySelectorAll(".age-btn").forEach((e=>{e.addEventListener("click",(()=>{localStorage.setItem("age",e.dataset.age),localStorage.setItem("refreshLandingUrl",!0)}))}))}document.querySelector(".age-btn")&&getAge(),cClarity=function(e){var t,n,o,i,a,r;t=window,n=document,i="script",t[o="clarity"]=t[o]||function(){(t[o].q=t[o].q||[]).push(arguments)},(a=n.createElement(i)).async=1,a.src="https://www.clarity.ms/tag/d2i7mxm1qf",(r=n.getElementsByTagName(i)[0]).parentNode.insertBefore(a,r)},cClarity(),getAllNeedData(),fillUrlParams();